<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>네이버 블로그 자동화 시스템</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #03c75a;
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            text-align: center;
            font-size: 28px;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #03c75a;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .category-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-category {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-category:hover, .btn-category.active {
            background-color: #03c75a;
            color: white;
        }
        
        .btn-primary {
            background-color: #03c75a;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #02a048;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .keyword-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .keyword-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .keyword-card:hover {
            border-color: #03c75a;
            transform: translateY(-2px);
        }
        
        .keyword-card.selected {
            border-color: #03c75a;
            background-color: #e8f5ec;
        }
        
        .keyword-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .keyword-category {
            font-size: 12px;
            color: #666;
        }
        
        .refined-keyword-card {
            background: #f0f9ff;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #e0f2fe;
            position: relative;
        }
        
        .refined-keyword-card:hover {
            border-color: #0284c7;
            transform: translateY(-2px);
        }
        
        .refined-keyword-card.selected {
            border-color: #0284c7;
            background-color: #dbeafe;
        }
        
        .keyword-type {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 10px;
            background: #0284c7;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .search-volume-bar {
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .search-volume-fill {
            height: 100%;
            background: #0284c7;
            border-radius: 2px;
            transition: width 0.3s;
        }
        
        .analysis-result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: bold;
            color: #03c75a;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .product-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .product-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.4;
            height: 40px;
            overflow: hidden;
        }
        
        .product-price {
            color: #03c75a;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .product-mall {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .product-actions .btn {
            flex: 1;
            font-size: 12px;
            padding: 8px 10px;
        }
        
        .content-preview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .content-preview pre {
            white-space: pre-wrap;
            font-family: inherit;
            line-height: 1.6;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .copy-button {
            float: right;
            margin-top: -10px;
        }
        
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #03c75a;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>🚀 네이버 블로그 자동화 시스템</h1>
        </div>
    </header>

    <div class="container">
        <!-- 트렌드 키워드 섹션 -->
        <div class="section">
            <h2>📊 트렌드 키워드 추천</h2>
            <div class="category-buttons">
                <button class="btn btn-category active" onclick="loadTrends('all', this)">전체</button>
                <button class="btn btn-category" onclick="loadTrends('인기급상승', this)" style="background-color: #ff6b6b; color: white;">🔥 인기급상승</button>
                <button class="btn btn-category" onclick="loadTrends('여름시즌', this)">여름시즌</button>
                <button class="btn btn-category" onclick="loadTrends('전자제품', this)">전자제품</button>
                <button class="btn btn-category" onclick="loadTrends('생활용품', this)">생활용품</button>
                <button class="btn btn-category" onclick="loadTrends('패션', this)">패션</button>
                <button class="btn btn-category" onclick="loadTrends('식품', this)">식품</button>
                <button class="btn btn-category" onclick="loadTrends('선물', this)">🎁 선물</button>
                <button class="btn btn-category" onclick="loadTrends('여행', this)">✈️ 여행</button>
            </div>
            <div id="keywordGrid" class="keyword-grid">
                <!-- 키워드 카드들이 여기에 동적으로 추가됨 -->
            </div>
        </div>

        <!-- 키워드 세분화 섹션 -->
        <div class="section" id="refinementSection" style="display: none;">
            <h2>🎯 세부 키워드 선택</h2>
            <p style="color: #666; margin-bottom: 15px;">더 구체적인 키워드를 선택하면 타겟팅이 정확해집니다.</p>
            <div id="refinedKeywords" class="keyword-grid">
                <!-- 세분화된 키워드들이 여기에 표시됨 -->
            </div>
        </div>

        <!-- 키워드 분석 결과 섹션 -->
        <div class="section" id="analysisSection" style="display: none;">
            <h2>📈 키워드 분석 결과</h2>
            <div id="analysisResult" class="analysis-result">
                <!-- 분석 결과가 여기에 표시됨 -->
            </div>
        </div>

        <!-- 상품 검색 결과 섹션 -->
        <div class="section" id="productsSection" style="display: none;">
            <h2>🛍️ 추천 상품</h2>
            <div id="productGrid" class="product-grid">
                <!-- 상품 카드들이 여기에 동적으로 추가됨 -->
            </div>
        </div>

        <!-- 콘텐츠 미리보기 섹션 -->
        <div class="section" id="contentSection" style="display: none;">
            <h2>📝 생성된 콘텐츠</h2>
            <button class="btn btn-primary copy-button" onclick="copyContent()">📋 복사하기</button>
            <div id="contentPreview" class="content-preview">
                <!-- 생성된 콘텐츠가 여기에 표시됨 -->
            </div>
        </div>
    </div>

    <!-- 로딩 오버레이 -->
    <div id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script>
        let selectedKeyword = null;
        let generatedContent = '';

        // 페이지 로드 시 초기 트렌드 로드
        window.onload = function() {
            loadTrends('all');
        };

        function clearPreviousResults() {
            // 모든 결과 섹션 숨기기
            document.getElementById('refinementSection').style.display = 'none';
            document.getElementById('analysisSection').style.display = 'none';
            document.getElementById('productsSection').style.display = 'none';
            document.getElementById('contentSection').style.display = 'none';
            
            // 내용 초기화
            document.getElementById('analysisResult').innerHTML = '';
            document.getElementById('productGrid').innerHTML = '';
            document.getElementById('contentPreview').innerHTML = '';
            
            // 선택된 키워드 초기화
            selectedKeyword = null;
            generatedContent = '';
            
            // 키워드 카드 선택 해제
            document.querySelectorAll('.keyword-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function loadTrends(category, buttonElement) {
            // 카테고리 버튼 활성화 상태 변경
            document.querySelectorAll('.btn-category').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // buttonElement가 있으면 사용, 없으면 category로 찾기
            if (buttonElement) {
                buttonElement.classList.add('active');
            } else if (category === 'all') {
                document.querySelector('.btn-category').classList.add('active');
            }

            // 이전 결과 숨기기
            clearPreviousResults();

            showLoading();
            fetch(`/api/trends?category=${category}`)
                .then(response => response.json())
                .then(data => {
                    displayKeywords(data.trends);
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error:', error);
                    hideLoading();
                });
        }

        function displayKeywords(trends) {
            const grid = document.getElementById('keywordGrid');
            grid.innerHTML = '';
            
            trends.forEach(trend => {
                const card = document.createElement('div');
                card.className = 'keyword-card';
                card.onclick = () => selectKeyword(trend.keyword, card);
                
                card.innerHTML = `
                    <div class="keyword-name">${trend.keyword}</div>
                    <div class="keyword-category">${trend.category}</div>
                `;
                
                grid.appendChild(card);
            });
        }

        function selectKeyword(keyword, element) {
            // 이전 선택 해제
            document.querySelectorAll('.keyword-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 새로운 선택
            element.classList.add('selected');
            selectedKeyword = keyword;
            
            // 콘텐츠 섹션 숨기기 (새 키워드 선택 시)
            document.getElementById('contentSection').style.display = 'none';
            generatedContent = '';
            
            // 키워드 세분화 요청
            refineKeyword(keyword);
        }
        
        function refineKeyword(keyword) {
            showLoading();
            fetch('/api/refine-keyword', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ keyword: keyword })
            })
            .then(response => response.json())
            .then(data => {
                displayRefinedKeywords(data);
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
            });
        }
        
        function displayRefinedKeywords(data) {
            const section = document.getElementById('refinementSection');
            const grid = document.getElementById('refinedKeywords');
            
            grid.innerHTML = '';
            
            // 메인 키워드 추가
            const mainCard = createRefinedKeywordCard({
                keyword: data.main_keyword,
                type: '메인',
                search_volume: 100
            }, true);
            grid.appendChild(mainCard);
            
            // 세분화된 키워드 추가
            data.refined_keywords.forEach(refined => {
                const card = createRefinedKeywordCard(refined, false);
                grid.appendChild(card);
            });
            
            section.style.display = 'block';
        }
        
        function createRefinedKeywordCard(refined, isMain) {
            const card = document.createElement('div');
            card.className = isMain ? 'refined-keyword-card selected' : 'refined-keyword-card';
            card.onclick = () => selectRefinedKeyword(refined.keyword, card);
            
            const typeColor = {
                '메인': '#03c75a',
                '카테고리': '#0284c7',
                '연관검색어': '#8b5cf6'
            };
            
            const volumeText = refined.actual_volume ? 
                `추정 월간 검색량: ${refined.actual_volume.toLocaleString()}회` : 
                `상대 검색량: ${refined.search_volume}%`;
            
            const shopText = refined.shop_count ? 
                `상품: ${refined.shop_count.toLocaleString()}개` : '';
                
            const blogText = refined.blog_count ? 
                `블로그: ${refined.blog_count.toLocaleString()}개` : '';
            
            card.innerHTML = `
                <span class="keyword-type" style="background: ${typeColor[refined.type] || '#666'}">${refined.type}</span>
                <div class="keyword-name">${refined.keyword}</div>
                <div class="search-volume-bar">
                    <div class="search-volume-fill" style="width: ${refined.search_volume}%"></div>
                </div>
                <div style="font-size: 11px; color: #666; margin-top: 5px;">
                    ${volumeText}<br>
                    <span style="font-size: 10px;">${shopText} ${blogText}</span>
                </div>
            `;
            
            return card;
        }
        
        function selectRefinedKeyword(keyword, element) {
            // 이전 선택 해제
            document.querySelectorAll('.refined-keyword-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 새로운 선택
            element.classList.add('selected');
            selectedKeyword = keyword;
            
            // 키워드 분석
            analyzeKeyword(keyword);
        }

        function analyzeKeyword(keyword) {
            showLoading();
            fetch('/api/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ keyword: keyword })
            })
            .then(response => response.json())
            .then(data => {
                displayAnalysis(data);
                searchProducts(keyword);
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
            });
        }

        function displayAnalysis(data) {
            const section = document.getElementById('analysisSection');
            const result = document.getElementById('analysisResult');
            
            result.innerHTML = `
                <h3>${data.keyword}</h3>
                <div class="metric">
                    <span class="metric-label">총 상품 수</span>
                    <span class="metric-value">${data.total_products.toLocaleString()}개</span>
                </div>
                <div class="metric">
                    <span class="metric-label">평균 가격</span>
                    <span class="metric-value">${data.avg_price.toLocaleString()}원</span>
                </div>
                <div class="metric">
                    <span class="metric-label">7일간 블로그 포스팅</span>
                    <span class="metric-value">${data.blog_posts_7d}${typeof data.blog_posts_7d === 'string' && data.blog_posts_7d.includes('+') ? '' : '개'}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">포스팅 빈도</span>
                    <span class="metric-value">${data.posting_frequency}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">커뮤니티 관심도</span>
                    <span class="metric-value">${data.community_interest}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">종합 점수</span>
                    <span class="metric-value">${data.total_score}점</span>
                </div>
                <div class="metric">
                    <span class="metric-label">추천도</span>
                    <span class="metric-value">${data.recommendation}</span>
                </div>
            `;
            
            section.style.display = 'block';
        }

        function searchProducts(keyword) {
            showLoading();
            fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ keyword: keyword })
            })
            .then(response => response.json())
            .then(data => {
                displayProducts(data.products);
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
            });
        }

        function displayProducts(products) {
            const section = document.getElementById('productsSection');
            const grid = document.getElementById('productGrid');
            
            grid.innerHTML = '';
            
            if (!products || products.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">
                        <p>😔 상품을 찾을 수 없습니다.</p>
                        <p style="font-size: 14px; margin-top: 10px;">다른 키워드를 선택해보세요.</p>
                    </div>
                `;
                section.style.display = 'block';
                return;
            }
            
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                
                card.innerHTML = `
                    ${product.image ? `<img src="${product.image}" alt="${product.title}" class="product-image" onerror="this.style.display='none'">` : '<div class="product-image"></div>'}
                    <div class="product-info">
                        <div class="product-title">${product.title}</div>
                        <div class="product-price">${product.price}원</div>
                        <div class="product-mall">${product.mall || '네이버쇼핑'}</div>
                        <div class="product-actions">
                            <a href="${product.link}" target="_blank" class="btn btn-secondary">구매링크</a>
                            <button class="btn btn-primary" onclick='generateContent(${JSON.stringify(product).replace(/'/g, "&apos;")})'>콘텐츠 제작</button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            section.style.display = 'block';
        }

        function generateContent(product) {
            if (!selectedKeyword) return;
            
            showLoading();
            fetch('/api/generate-content', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    keyword: selectedKeyword,
                    product: product
                })
            })
            .then(response => response.json())
            .then(data => {
                displayContent(data.content);
                generatedContent = data.content;
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
            });
        }

        function displayContent(content) {
            const section = document.getElementById('contentSection');
            const preview = document.getElementById('contentPreview');
            
            preview.innerHTML = `<pre>${content}</pre>`;
            section.style.display = 'block';
            
            // 스크롤 이동
            section.scrollIntoView({ behavior: 'smooth' });
        }

        function copyContent() {
            if (!generatedContent) return;
            
            navigator.clipboard.writeText(generatedContent).then(() => {
                alert('콘텐츠가 클립보드에 복사되었습니다!');
            }).catch(err => {
                console.error('복사 실패:', err);
            });
        }
    </script>
</body>
</html>