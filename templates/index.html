<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìë™í™” ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #03c75a;
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            text-align: center;
            font-size: 28px;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #03c75a;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .category-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-category {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-category:hover, .btn-category.active {
            background-color: #03c75a;
            color: white;
        }
        
        .btn-primary {
            background-color: #03c75a;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #02a048;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .keyword-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .keyword-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .keyword-card:hover {
            border-color: #03c75a;
            transform: translateY(-2px);
        }
        
        .keyword-card.selected {
            border-color: #03c75a;
            background-color: #e8f5ec;
        }
        
        .keyword-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .keyword-category {
            font-size: 12px;
            color: #666;
        }
        
        .refined-keyword-card {
            background: #f0f9ff;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #e0f2fe;
            position: relative;
        }
        
        .refined-keyword-card:hover {
            border-color: #0284c7;
            transform: translateY(-2px);
        }
        
        .refined-keyword-card.selected {
            border-color: #0284c7;
            background-color: #dbeafe;
        }
        
        .keyword-type {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 10px;
            background: #0284c7;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .search-volume-bar {
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .search-volume-fill {
            height: 100%;
            background: #0284c7;
            border-radius: 2px;
            transition: width 0.3s;
        }
        
        .analysis-result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: bold;
            color: #03c75a;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .product-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .product-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.4;
            height: 40px;
            overflow: hidden;
        }
        
        .product-price {
            color: #03c75a;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .product-mall {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .product-actions .btn {
            flex: 1;
            font-size: 12px;
            padding: 8px 10px;
        }
        
        .content-preview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .content-preview pre {
            white-space: pre-wrap;
            font-family: inherit;
            line-height: 1.6;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .copy-button {
            float: right;
            margin-top: -10px;
        }
        
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #03c75a;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸš€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìë™í™” ì‹œìŠ¤í…œ</h1>
        </div>
    </header>

    <div class="container">
        <!-- íŠ¸ë Œë“œ í‚¤ì›Œë“œ ì„¹ì…˜ -->
        <div class="section">
            <h2>ğŸ“Š íŠ¸ë Œë“œ í‚¤ì›Œë“œ ì¶”ì²œ</h2>
            <div class="category-buttons">
                <button class="btn btn-category active" onclick="loadTrends('all', this)">ì „ì²´</button>
                <button class="btn btn-category" onclick="loadTrends('ì¸ê¸°ê¸‰ìƒìŠ¹', this)" style="background-color: #ff6b6b; color: white;">ğŸ”¥ ì¸ê¸°ê¸‰ìƒìŠ¹</button>
                <button class="btn btn-category" onclick="loadTrends('ì—¬ë¦„ì‹œì¦Œ', this)">ì—¬ë¦„ì‹œì¦Œ</button>
                <button class="btn btn-category" onclick="loadTrends('ì „ìì œí’ˆ', this)">ì „ìì œí’ˆ</button>
                <button class="btn btn-category" onclick="loadTrends('ìƒí™œìš©í’ˆ', this)">ìƒí™œìš©í’ˆ</button>
                <button class="btn btn-category" onclick="loadTrends('íŒ¨ì…˜', this)">íŒ¨ì…˜</button>
                <button class="btn btn-category" onclick="loadTrends('ì‹í’ˆ', this)">ì‹í’ˆ</button>
                <button class="btn btn-category" onclick="loadTrends('ì„ ë¬¼', this)">ğŸ ì„ ë¬¼</button>
                <button class="btn btn-category" onclick="loadTrends('ì—¬í–‰', this)">âœˆï¸ ì—¬í–‰</button>
            </div>
            <div id="keywordGrid" class="keyword-grid">
                <!-- í‚¤ì›Œë“œ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
            </div>
        </div>

        <!-- í‚¤ì›Œë“œ ì„¸ë¶„í™” ì„¹ì…˜ -->
        <div class="section" id="refinementSection" style="display: none;">
            <h2>ğŸ¯ ì„¸ë¶€ í‚¤ì›Œë“œ ì„ íƒ</h2>
            <p style="color: #666; margin-bottom: 15px;">ë” êµ¬ì²´ì ì¸ í‚¤ì›Œë“œë¥¼ ì„ íƒí•˜ë©´ íƒ€ê²ŸíŒ…ì´ ì •í™•í•´ì§‘ë‹ˆë‹¤.</p>
            <div id="refinedKeywords" class="keyword-grid">
                <!-- ì„¸ë¶„í™”ëœ í‚¤ì›Œë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë¨ -->
            </div>
        </div>

        <!-- í‚¤ì›Œë“œ ë¶„ì„ ê²°ê³¼ ì„¹ì…˜ -->
        <div class="section" id="analysisSection" style="display: none;">
            <h2>ğŸ“ˆ í‚¤ì›Œë“œ ë¶„ì„ ê²°ê³¼</h2>
            <div id="analysisResult" class="analysis-result">
                <!-- ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë¨ -->
            </div>
        </div>

        <!-- ìƒí’ˆ ê²€ìƒ‰ ê²°ê³¼ ì„¹ì…˜ -->
        <div class="section" id="productsSection" style="display: none;">
            <h2>ğŸ›ï¸ ì¶”ì²œ ìƒí’ˆ</h2>
            <div id="productGrid" class="product-grid">
                <!-- ìƒí’ˆ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
            </div>
        </div>

        <!-- ì½˜í…ì¸  ë¯¸ë¦¬ë³´ê¸° ì„¹ì…˜ -->
        <div class="section" id="contentSection" style="display: none;">
            <h2>ğŸ“ ìƒì„±ëœ ì½˜í…ì¸ </h2>
            <button class="btn btn-primary copy-button" onclick="copyContent()">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
            <div id="contentPreview" class="content-preview">
                <!-- ìƒì„±ëœ ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— í‘œì‹œë¨ -->
            </div>
        </div>
    </div>

    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script>
        let selectedKeyword = null;
        let generatedContent = '';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° íŠ¸ë Œë“œ ë¡œë“œ
        window.onload = function() {
            loadTrends('all');
        };

        function clearPreviousResults() {
            // ëª¨ë“  ê²°ê³¼ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.getElementById('refinementSection').style.display = 'none';
            document.getElementById('analysisSection').style.display = 'none';
            document.getElementById('productsSection').style.display = 'none';
            document.getElementById('contentSection').style.display = 'none';
            
            // ë‚´ìš© ì´ˆê¸°í™”
            document.getElementById('analysisResult').innerHTML = '';
            document.getElementById('productGrid').innerHTML = '';
            document.getElementById('contentPreview').innerHTML = '';
            
            // ì„ íƒëœ í‚¤ì›Œë“œ ì´ˆê¸°í™”
            selectedKeyword = null;
            generatedContent = '';
            
            // í‚¤ì›Œë“œ ì¹´ë“œ ì„ íƒ í•´ì œ
            document.querySelectorAll('.keyword-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function loadTrends(category, buttonElement) {
            // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.btn-category').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // buttonElementê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ categoryë¡œ ì°¾ê¸°
            if (buttonElement) {
                buttonElement.classList.add('active');
            } else if (category === 'all') {
                document.querySelector('.btn-category').classList.add('active');
            }

            // ì´ì „ ê²°ê³¼ ìˆ¨ê¸°ê¸°
            clearPreviousResults();

            showLoading();
            fetch(`/api/trends?category=${category}`)
                .then(response => response.json())
                .then(data => {
                    displayKeywords(data.trends);
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error:', error);
                    hideLoading();
                });
        }

        function displayKeywords(trends) {
            const grid = document.getElementById('keywordGrid');
            grid.innerHTML = '';
            
            trends.forEach(trend => {
                const card = document.createElement('div');
                card.className = 'keyword-card';
                card.onclick = () => selectKeyword(trend.keyword, card);
                
                card.innerHTML = `
                    <div class="keyword-name">${trend.keyword}</div>
                    <div class="keyword-category">${trend.category}</div>
                `;
                
                grid.appendChild(card);
            });
        }

        function selectKeyword(keyword, element) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.keyword-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ìƒˆë¡œìš´ ì„ íƒ
            element.classList.add('selected');
            selectedKeyword = keyword;
            
            // ì½˜í…ì¸  ì„¹ì…˜ ìˆ¨ê¸°ê¸° (ìƒˆ í‚¤ì›Œë“œ ì„ íƒ ì‹œ)
            document.getElementById('contentSection').style.display = 'none';
            generatedContent = '';
            
            // í‚¤ì›Œë“œ ì„¸ë¶„í™” ìš”ì²­
            refineKeyword(keyword);
        }
        
        function refineKeyword(keyword) {
            showLoading();
            fetch('/api/refine-keyword', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ keyword: keyword })
            })
            .then(response => response.json())
            .then(data => {
                displayRefinedKeywords(data);
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
            });
        }
        
        function displayRefinedKeywords(data) {
            const section = document.getElementById('refinementSection');
            const grid = document.getElementById('refinedKeywords');
            
            grid.innerHTML = '';
            
            // ë©”ì¸ í‚¤ì›Œë“œ ì¶”ê°€
            const mainCard = createRefinedKeywordCard({
                keyword: data.main_keyword,
                type: 'ë©”ì¸',
                search_volume: 100
            }, true);
            grid.appendChild(mainCard);
            
            // ì„¸ë¶„í™”ëœ í‚¤ì›Œë“œ ì¶”ê°€
            data.refined_keywords.forEach(refined => {
                const card = createRefinedKeywordCard(refined, false);
                grid.appendChild(card);
            });
            
            section.style.display = 'block';
        }
        
        function createRefinedKeywordCard(refined, isMain) {
            const card = document.createElement('div');
            card.className = isMain ? 'refined-keyword-card selected' : 'refined-keyword-card';
            card.onclick = () => selectRefinedKeyword(refined.keyword, card);
            
            const typeColor = {
                'ë©”ì¸': '#03c75a',
                'ì¹´í…Œê³ ë¦¬': '#0284c7',
                'ì—°ê´€ê²€ìƒ‰ì–´': '#8b5cf6'
            };
            
            const volumeText = refined.actual_volume ? 
                `ì¶”ì • ì›”ê°„ ê²€ìƒ‰ëŸ‰: ${refined.actual_volume.toLocaleString()}íšŒ` : 
                `ìƒëŒ€ ê²€ìƒ‰ëŸ‰: ${refined.search_volume}%`;
            
            const shopText = refined.shop_count ? 
                `ìƒí’ˆ: ${refined.shop_count.toLocaleString()}ê°œ` : '';
                
            const blogText = refined.blog_count ? 
                `ë¸”ë¡œê·¸: ${refined.blog_count.toLocaleString()}ê°œ` : '';
            
            card.innerHTML = `
                <span class="keyword-type" style="background: ${typeColor[refined.type] || '#666'}">${refined.type}</span>
                <div class="keyword-name">${refined.keyword}</div>
                <div class="search-volume-bar">
                    <div class="search-volume-fill" style="width: ${refined.search_volume}%"></div>
                </div>
                <div style="font-size: 11px; color: #666; margin-top: 5px;">
                    ${volumeText}<br>
                    <span style="font-size: 10px;">${shopText} ${blogText}</span>
                </div>
            `;
            
            return card;
        }
        
        function selectRefinedKeyword(keyword, element) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.refined-keyword-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ìƒˆë¡œìš´ ì„ íƒ
            element.classList.add('selected');
            selectedKeyword = keyword;
            
            // í‚¤ì›Œë“œ ë¶„ì„
            analyzeKeyword(keyword);
        }

        function analyzeKeyword(keyword) {
            showLoading();
            fetch('/api/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ keyword: keyword })
            })
            .then(response => response.json())
            .then(data => {
                displayAnalysis(data);
                searchProducts(keyword);
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
            });
        }

        function displayAnalysis(data) {
            const section = document.getElementById('analysisSection');
            const result = document.getElementById('analysisResult');
            
            result.innerHTML = `
                <h3>${data.keyword}</h3>
                <div class="metric">
                    <span class="metric-label">ì´ ìƒí’ˆ ìˆ˜</span>
                    <span class="metric-value">${data.total_products.toLocaleString()}ê°œ</span>
                </div>
                <div class="metric">
                    <span class="metric-label">í‰ê·  ê°€ê²©</span>
                    <span class="metric-value">${data.avg_price.toLocaleString()}ì›</span>
                </div>
                <div class="metric">
                    <span class="metric-label">7ì¼ê°„ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…</span>
                    <span class="metric-value">${data.blog_posts_7d}${typeof data.blog_posts_7d === 'string' && data.blog_posts_7d.includes('+') ? '' : 'ê°œ'}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">í¬ìŠ¤íŒ… ë¹ˆë„</span>
                    <span class="metric-value">${data.posting_frequency}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ì»¤ë®¤ë‹ˆí‹° ê´€ì‹¬ë„</span>
                    <span class="metric-value">${data.community_interest}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ì¢…í•© ì ìˆ˜</span>
                    <span class="metric-value">${data.total_score}ì </span>
                </div>
                <div class="metric">
                    <span class="metric-label">ì¶”ì²œë„</span>
                    <span class="metric-value">${data.recommendation}</span>
                </div>
            `;
            
            section.style.display = 'block';
        }

        function searchProducts(keyword) {
            showLoading();
            fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ keyword: keyword })
            })
            .then(response => response.json())
            .then(data => {
                displayProducts(data.products);
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
            });
        }

        function displayProducts(products) {
            const section = document.getElementById('productsSection');
            const grid = document.getElementById('productGrid');
            
            grid.innerHTML = '';
            
            if (!products || products.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">
                        <p>ğŸ˜” ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="font-size: 14px; margin-top: 10px;">ë‹¤ë¥¸ í‚¤ì›Œë“œë¥¼ ì„ íƒí•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                section.style.display = 'block';
                return;
            }
            
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                
                card.innerHTML = `
                    ${product.image ? `<img src="${product.image}" alt="${product.title}" class="product-image" onerror="this.style.display='none'">` : '<div class="product-image"></div>'}
                    <div class="product-info">
                        <div class="product-title">${product.title}</div>
                        <div class="product-price">${product.price}ì›</div>
                        <div class="product-mall">${product.mall || 'ë„¤ì´ë²„ì‡¼í•‘'}</div>
                        <div class="product-actions">
                            <a href="${product.link}" target="_blank" class="btn btn-secondary">êµ¬ë§¤ë§í¬</a>
                            <button class="btn btn-primary" onclick='generateContent(${JSON.stringify(product).replace(/'/g, "&apos;")})'>ì½˜í…ì¸  ì œì‘</button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            section.style.display = 'block';
        }

        function generateContent(product) {
            if (!selectedKeyword) return;
            
            showLoading();
            fetch('/api/generate-content', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    keyword: selectedKeyword,
                    product: product
                })
            })
            .then(response => response.json())
            .then(data => {
                displayContent(data.content);
                generatedContent = data.content;
                hideLoading();
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoading();
            });
        }

        function displayContent(content) {
            const section = document.getElementById('contentSection');
            const preview = document.getElementById('contentPreview');
            
            preview.innerHTML = `<pre>${content}</pre>`;
            section.style.display = 'block';
            
            // ìŠ¤í¬ë¡¤ ì´ë™
            section.scrollIntoView({ behavior: 'smooth' });
        }

        function copyContent() {
            if (!generatedContent) return;
            
            navigator.clipboard.writeText(generatedContent).then(() => {
                alert('ì½˜í…ì¸ ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
            });
        }
    </script>
</body>
</html>